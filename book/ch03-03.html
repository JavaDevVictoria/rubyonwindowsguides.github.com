<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Postgresql Database</title>
   <meta name="author" content="Boško Ivanišević" />

   <link rel="stylesheet" href="/css/960.css" type="text/css" />
   <link rel="stylesheet" href="/css/reset.css" type="text/css" />
   <link rel="stylesheet" href="/css/text.css" type="text/css" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />

   <!-- Update your html tag to include the itemscope and itemtype attributes -->
   <html itemscope itemtype="http://schema.org/Book">

   <!-- Add the following three tags inside head -->
   <meta itemprop="name" content="Ruby On Windows Guides">
   <meta itemprop="description" content="Comprehensive guides for Ruby on Windows">

   <!-- Place this render call where appropriate -->
   <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
   </script>

   <script type="text/javascript">

     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-26061460-1']);
     _gaq.push(['_trackPageview']);

     (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>
</head>
<body>

<div class="container_12">
  <!--<div class="grid_2">
    <br/>
    <h1>Something</h1>
    <p>
      Lorem ipsum, etc, etc, so on and so forth
    </p>
  </div>-->

  <div id="main" class="grid_10">
    <div id="header" class="grid_10">
      <br/>
      <table>
        <tr>
          <td><img src="/images/rwg_logo_blue.png"/></td>
          <td>
            <h1>Ruby on Windows Guides</h1>
            <h4>Comprehensive guides for Ruby on Windows</h4>
            <h6>by Bosko Ivanisevic</h6>
          </td>
        </tr>
      </table>
    </div>

    <div id="menu" class="grid_10">
      <a href="/">Book</a>
      <a href="/about.html">About</a>
      <!-- <a href="/something.html">Something</a> -->
    </div>

    <div id="content" class="grid_10">
      <!-- Place this tag where you want the +1 button to render -->
      <g:plusone annotation="inline"></g:plusone>
      <br/>
      
      <a href="/book/ch03-02.html" title="Previous: Mysql Database">&laquo; Mysql Database</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-04.html" title="Next: Ms Sql Server">Ms Sql Server &raquo; </a>
       
      <br/><br/>

      <h2>PostgreSQL database</h2>
<p>This is the third in a row of databases with built-in support in Ruby on Rails. Similarly to MySQL we will skip installation and will use server from .zip archive. Unpack archive to the root of your <code>C:</code> drive (or any other one if you want). New directory <code>pgsql</code> will be created and all files will be extracted there. The very first thing we have to do is to initialize server instance. This will create all necessary files needed for PostgreSQL server. Go to the bin sub-directory within <code>pgsql</code> directory and execute <code>intidb</code> command and pass it directory where data files will be stored. Output should look similar to the one given below:</p>
<div>
<pre><code class='bat'>C:\pgsql\bin&amp;gt;initdb -D ..\data
<p>The files belonging to this database system will be owned by user &quot;bosko&quot;.<br />
This user must also own the server process.</p>
<p>The database cluster will be initialized with locale English_United States.1252.</p>
<p>The default text search configuration will be set to &quot;english&quot;.</p>
<p>fixing permissions on existing directory ../data &#8230; ok<br />
creating subdirectories &#8230; ok<br />
selecting default max_connections &#8230; 100<br />
selecting default shared_buffers &#8230; 32MB<br />
creating configuration files &#8230; ok<br />
creating template1 database in ../data/base/1 &#8230; ok<br />
initializing pg_authid &#8230; ok<br />
initializing dependencies &#8230; ok<br />
creating system views &#8230; ok<br />
loading system objects&#8217; descriptions &#8230; ok<br />
creating conversions &#8230; ok<br />
creating dictionaries &#8230; ok<br />
setting privileges on built-in objects &#8230; ok<br />
creating information schema &#8230; ok<br />
loading PL/pgSQL server-side language &#8230; ok<br />
vacuuming database template1 &#8230; ok<br />
copying template1 to template0 &#8230; ok<br />
copying template1 to postgres &#8230; ok</p>
<p><span class="caps">WARNING</span>: enabling &quot;trust&quot; authentication for local connections<br />
You can change this by editing pg_hba.conf or using the -A option the<br />
next time you run initdb.</p>
<p>Success. You can now start the database server using:</p>
&quot;postgres&quot; -D &quot;../data&quot;
<p>or<br />
    &quot;pg_ctl&quot; -D &quot;../data&quot; -l logfile start</code></pre></p>
</div>
<p>As output of the initdb command suggests we can now start database server:</p>
<div>
<pre><code class='bat'>C:\pgsql\bin&amp;gt;postgres -D ..\data</code></pre>
</div>
<p>Let&#8217;s check whether our server is working. Don&#8217;t forget to change &#8216;bosko&#8217; with the user name under which you are working in Windows in the command below (this name is displayed in the first line of the log message if initdb command):</p>
<div>
<pre><code class='bat'>C:\pgsql\bin&amp;gt;psql -d template1 -U bosko
<p>psql (9.0.2)<br />
<span class="caps">WARNING</span>: Console code page (437) differs from Windows code page (1252)<br />
         8-bit characters might not work correctly. See psql reference<br />
         page &quot;Notes for Windows users&quot; for details.<br />
Type &quot;help&quot; for help.</p>
<p>postgres=# \l<br />
                                             List of databases<br />
   Name    | Owner | Encoding |         Collation          |           Ctype            | Access privileges<br />
<del>-</del>&#8212;&#8212;&#8212;&#8212;<ins><del>-</del>&#8212;&#8212;</ins>&#8212;&#8212;&#8212;&#8212;&#8212;<ins><del>-</del>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</ins>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-<br />
 postgres  | bosko | UTF8     | English_United States.1252 | English_United States.1252 |<br />
 template0 | bosko | UTF8     | English_United States.1252 | English_United States.1252 | =c/bosko         +<br />
           |       |          |                            |                            | bosko=CTc/bosko<br />
 template1 | bosko | UTF8     | English_United States.1252 | English_United States.1252 | =c/bosko         +<br />
           |       |          |                            |                            | bosko=CTc/bosko<br />
(3 rows)<br />
postgres=#</code></pre></p>
</div>
<p>If you see above lines your PostgreSQL server is running and ready. It is now time to create database for our rwin_book application. For this you can use <span class="caps">GUI</span> application pgAdmin3.exe or already started psql console client. I will stick with the console application. In the psql prompt execute following command:</p>
<div>
<pre><code class='bat'>postgres=# create database rwin_book_devel;</code></pre>
</div>
<p>In two chapters dedicated to native gems installation we installed sqlite3 and mysql2 gems so we were ready for these databases. For the PostgreSQL server we are still missing gem extension needed to connect to it. Before we configure our Rails application to use new database we have to install it:</p>
<div>
<pre><code class='bat'>c:\projects\rwin_book&amp;gt;gem install pg --version=0.9.0
<p>Successfully installed pg-0.9.0-x86-mingw32<br />
1 gem installed<br />
Installing ri documentation for pg-0.9.0-x86-mingw32&#8230;<br />
Installing RDoc documentation for pg-0.9.0-x86-mingw32&#8230;</code></pre></p>
</div>
<p>Version 0.9.0 has MinGW binaries that work on Windows. That&#8217;s the reason why we must install this and not the latest version. At the end we have to configure Rails application to use new database. For that use postgresql for adapter name in database.yml and add a line that requires pg in the application&#8217;s Gemfile. As we did we previous databases we must start database migration:</p>
<div>
<pre><code class='bat'>c:\projects\rwin_book&amp;gt;rake db:migrate
<p>(in c:/projects/rwin_book)<br />
==  CreateRubyWinSources: migrating ===========<br />
&#8212; create_table(:ruby_win_sources)<br />
<span class="caps">NOTICE</span>:  <span class="caps">CREATE</span> <span class="caps">TABLE</span> will create implicit sequence &quot;ruby_win_sources_id_seq&quot; <br />
for serial column &quot;ruby_win_sources.id&quot;<br />
<span class="caps">NOTICE</span>:  <span class="caps">CREATE</span> <span class="caps">TABLE</span> / <span class="caps">PRIMARY</span> <span class="caps">KEY</span> will create implicit index &quot;ruby_win_sources_pkey&quot; <br />
for table &quot;ruby_win_sources&quot;<br />
   -&gt; 0.3605s<br />
==  CreateRubyWinSources: migrated (0.3605s) ==========</code></pre></p>
</div>
<p>This ends our journey through built-in support for database engines. All of them are functional and it is up to you which one you will use in Rails applications.</p>

      <br/>
      
      <a href="/book/ch03-02.html" title="Previous: Mysql Database">&laquo; Mysql Database</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-04.html" title="Next: Ms Sql Server">Ms Sql Server &raquo; </a>
       
    </div>

    <hr>
  </div>
</div>

</body>
</html>
