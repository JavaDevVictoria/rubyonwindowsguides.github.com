<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Sqlite3 Database</title>
   <meta name="author" content="Boško Ivanišević" />

   <link rel="stylesheet" href="/css/960.css" type="text/css" />
   <link rel="stylesheet" href="/css/reset.css" type="text/css" />
   <link rel="stylesheet" href="/css/text.css" type="text/css" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />

   <script type="text/javascript">

     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-26061460-1']);
     _gaq.push(['_trackPageview']);

     (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>
</head>
<body>

<div class="container_12">
  <!--<div class="grid_2">
    <br/>
    <h1>Something</h1>
    <p>
      Lorem ipsum, etc, etc, so on and so forth
    </p>
  </div>-->

  <div id="main" class="grid_10">
    <div id="header" class="grid_10">
      <br/>
      <table>
        <tr>
          <td><img src="/images/rwg_logo_blue.png"/></td>
          <td>
            <h1>Ruby on Windows Guides</h1>
            <!-- <h3>Comprehensive guides for Ruby on Windows</h3> -->
          </td>
        </tr>
      </table>
    </div>

    <div id="menu" class="grid_10">
      <a href="/">Book</a>
      <a href="/about.html">About</a>
      <!-- <a href="/something.html">Something</a> -->
    </div>

    <div id="content" class="grid_10">
      
      <a href="/book/ch03-00.html" title="Previous: Ruby On Rails 3 On Windows">&laquo; Ruby On Rails 3 On Windows</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-02.html" title="Next: Mysql Database">Mysql Database &raquo; </a>
       
      <br/><br/>

      <h2>SQlite3 database</h2>
<p>SQlite3 database is default database used when new Ruby on Rails application is created. This can be changed with the <code>-d</code> or <code>--database</code> option with allowed values: <code>mysql</code>, <code>oracle</code>, <code>postgresql</code>, <code>sqlite3</code>, <code>frontbase</code>, <code>ibm_db</code>. We&#8217;ll stick with default value and create new Rails application:</p>
<div class="highlight"><pre><code class="bat">C:\projects<span class="p">&gt;</span><span class="n">rails</span> new rwin_book
      create
      create  README
      create  Rakefile
      create  config.ru
      create  .gitignore
      create  Gemfile
      create  app
      create  app<span class="n">/controllers/application_controller.rb</span>
      create  app<span class="n">/helpers/application_helper.rb</span>
      create  app<span class="n">/mailers</span>
      create  app<span class="n">/models</span>
      create  app<span class="n">/views/layouts/application.html.erb</span>
      create  config
      create  config<span class="n">/routes.rb</span>
      create  config<span class="n">/application.rb</span>
      create  config<span class="n">/environment.rb</span>
      create  config<span class="n">/environments</span>
      create  config<span class="n">/environments/development.rb</span>
      create  config<span class="n">/environments/production.rb</span>
      create  config<span class="n">/environments/test.rb</span>
      create  config<span class="n">/initializers</span>
      create  config<span class="n">/initializers/backtrace_silencers.rb</span>
      create  config<span class="n">/initializers/inflections.rb</span>
      create  config<span class="n">/initializers/mime_types.rb</span>
      create  config<span class="n">/initializers/secret_token.rb</span>
      create  config<span class="n">/initializers/session_store.rb</span>
      create  config<span class="n">/locales</span>
      create  config<span class="n">/locales/en.yml</span>
      create  config<span class="n">/boot.rb</span>
      create  config<span class="n">/database.yml</span>
      create  db
      create  db<span class="n">/seeds.rb</span>
      create  doc
      create  doc<span class="n">/README_FOR_APP</span>
      create  lib
      create  lib<span class="n">/tasks</span>
      create  lib<span class="n">/tasks/.gitkeep</span>
      create  log
      create  log<span class="n">/server.log</span>
      create  log<span class="n">/production.log</span>
      create  log<span class="n">/development.log</span>
      create  log<span class="n">/test.log</span>
      create  public
      create  public<span class="n">/404.html</span>
      create  public<span class="n">/422.html</span>
      create  public<span class="n">/500.html</span>
      create  public<span class="n">/favicon.ico</span>
      create  public<span class="n">/index.html</span>
      create  public<span class="n">/robots.txt</span>
      create  public<span class="n">/images</span>
      create  public<span class="n">/images/rails.png</span>
      create  public<span class="n">/stylesheets</span>
      create  public<span class="n">/stylesheets/.gitkeep</span>
      create  public<span class="n">/javascripts</span>
      create  public<span class="n">/javascripts/application.js</span>
      create  public<span class="n">/javascripts/controls.js</span>
      create  public<span class="n">/javascripts/dragdrop.js</span>
      create  public<span class="n">/javascripts/effects.js</span>
      create  public<span class="n">/javascripts/prototype.js</span>
      create  public<span class="n">/javascripts/rails.js</span>
      create  script
      create  script<span class="n">/rails</span>
      create  test
      create  test<span class="n">/fixtures</span>
      create  test<span class="n">/functional</span>
      create  test<span class="n">/integration</span>
      create  test<span class="n">/performance/browsing_test.rb</span>
      create  test<span class="n">/test_helper.rb</span>
      create  test<span class="n">/unit</span>
      create  tmp
      create  tmp<span class="n">/sessions</span>
      create  tmp<span class="n">/sockets</span>
      create  tmp<span class="n">/cache</span>
      create  tmp<span class="n">/pids</span>
      create  vendor<span class="n">/plugins</span>
      create  vendor<span class="n">/plugins/.gitkeep</span>
</code></pre>
</div><p>Rails has created basic structure of our application. If you open config\database.yml file in the editor you will see that application is completely configured for SQlite3 database:</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># SQLite version 3.x</span>
<span class="c1">#   gem install sqlite3-ruby (not necessary on OS X Leopard)</span>
<span class="n">development</span><span class="p">:</span>
  <span class="n">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
  <span class="n">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">development</span><span class="o">.</span><span class="n">sqlite3</span>
  <span class="n">pool</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">timeout</span><span class="p">:</span> <span class="mi">5000</span>

<span class="c1"># Warning: The database defined as &quot;test&quot; will be erased and</span>
<span class="c1"># re-generated from your development database when you run &quot;rake&quot;.</span>
<span class="c1"># Do not set this db to the same as development or production.</span>
<span class="nb">test</span><span class="p">:</span>
  <span class="n">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
  <span class="n">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="nb">test</span><span class="o">.</span><span class="n">sqlite3</span>
  <span class="n">pool</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">timeout</span><span class="p">:</span> <span class="mi">5000</span>

<span class="n">production</span><span class="p">:</span>
  <span class="n">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
  <span class="n">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">production</span><span class="o">.</span><span class="n">sqlite3</span>
  <span class="n">pool</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">timeout</span><span class="p">:</span> <span class="mi">5000</span>
</code></pre>
</div><p>All three environments: development, test and production will use different SQlite3 databases named after the name of the corresponding environment with extension .sqlite3.</p>
<p>Let&#8217;s start our new application. Go to rwin_book directory and execute:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rails</span> server
</code></pre>
</div><p>If you get following message:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rails</span>
Could not find gem <span class="s1">&#39;sqlite3-ruby (&gt;= 0, runtime)&#39;</span> in any of the gem
sources listed in your Gemfile.
</code></pre>
</div><p>Try running `bundle install`.</p>
<p>You probably have Rails 3.0.3 version which uses sqlite3-ruby gem which is obsolete. Between versions 1.3.2 and 1.3.3 sqlite3-ruby gem was renamed to sqlite3. However sqlite3-ruby still can be installed for compatibility purposes. This gem is actually empty one that just requires new sqlite3 gem and can be used till all applications are updated to use new one. So if this is the case just install sqlite3-ruby:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">gem</span> install sqlite<span class="m">3</span>-ruby --no-rdoc --no-ri
#######################################################

Hello! The sqlite<span class="m">3</span>-ruby gem has changed it&#39;s name to just sqlite<span class="m">3</span>.  Rather than
installing <span class="sb">`sqlite3-ruby`</span><span class="p">,</span> you should install <span class="sb">`sqlite3`</span>.  Please update your
dependencies accordingly.

Thanks from the Ruby sqlite<span class="m">3</span> team!

<span class="p">&lt;</span><span class="n">3</span> <span class="p">&lt;</span><span class="n">3</span> <span class="p">&lt;</span><span class="n">3</span> <span class="p">&lt;</span><span class="n">3</span>

#######################################################
Successfully installed sqlite<span class="m">3</span>-ruby<span class="m">-1</span>.<span class="m">3</span>.<span class="m">3</span>
<span class="m">1</span> gem installed
</code></pre>
</div><p>You can now start application WEBrick server. If you followed all instructions from the book you will see server&#8217;s log messages in the Command Prompt:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rails</span> server
<span class="o">=</span><span class="p">&gt;</span> <span class="n">Booting</span> WEBrick
<span class="o">=</span><span class="p">&gt;</span> <span class="n">Rails</span> <span class="m">3</span>.<span class="m">0</span>.<span class="m">3</span> application starting in development <span class="k">on</span> http:<span class="n">//0.0.0.0:3000</span>
<span class="o">=</span><span class="p">&gt;</span> <span class="n">Call</span> with -d to detach
<span class="o">=</span><span class="p">&gt;</span> <span class="n">Ctrl</span>-C to shutdown server
[<span class="m">2011-02-02</span> <span class="m">19</span><span class="nl">:01:07</span>] INFO  WEBrick <span class="m">1</span>.<span class="m">3</span>.<span class="m">1</span>
[<span class="m">2011-02-02</span> <span class="m">19</span><span class="nl">:01:07</span>] INFO  ruby <span class="m">1</span>.<span class="m">9</span>.<span class="m">2</span> (<span class="m">2010-12-25</span>) [i<span class="m">386</span>-mingw<span class="m">32</span>]
[<span class="m">2011-02-02</span> <span class="m">19</span><span class="nl">:01:07</span>] INFO  WEBrick<span class="c">::HTTPServer#start: pid=800 port=3000</span>
</code></pre>
</div><p>But if you jumped right to this chapter you there are few important things I must emphasize. If you built sqlite3 gem from the sources it is linked against libsqlite3-0.dll and this shared library must be in the path. In the chapter Building Native Gems we copied it to the C:\tools folder and added this directory to the path. You have to copy sqlite3.exe file to that folder too since we will need it soon.</p>
<p>On the other hand if you just installed binary version of sqlite3 gem it is linked against sqlite3.dll. This is actually the same shared library but with different name. In that case you have two solutions. The first one is to just rename built dll or you can download official version from SQlite3 site and unpack it to the folder that is in the path. Nevertheless SQlite3&#8217;s shared library and executable must be in the path. This is common mistake of Rails on Windows beginners so keep that on your mind.</p>
<p><img src="/images/fig0301.png" title="Rails welcome page" alt="Rails welcome page" /></p>
<p>Now open Web browser and go to Rails welcome page at http://localhost:3000. It gives you few hints how to start developing Rails application and, if you click on the top link, it will show you information about your application&#8217;s environment.</p>
<p>So far, so good. Be we still haven&#8217;t do anything with the database so we cannot be sure the SQlite3 gem is working as expected. Open new Command Prompt, go to the root folder of your new Rails application and execute following rake task:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rake</span> db:create
</code></pre>
</div><p>If you get warning messages that database files already exist do not worry since this is just and information that application has found newly created databases. Namely for SQlite3 there is no need to create database in advance. Rails will do that for you if database does not exist. Finally start Rails database console and check a list of all tables in the database:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rails</span> dbconsole
SQLite version <span class="m">3</span>.<span class="m">7</span>.<span class="m">4</span>
Enter <span class="s2">&quot;.help&quot;</span> <span class="k">for</span> instructions
Enter SQL statements terminated with a <span class="s2">&quot;;&quot;</span>
sqlite&gt; .tables
sqlite&gt;
</code></pre>
</div><p>Of course we didn&#8217;t create any table so the list is empty. Time is to create some. Since we are working with Ruby on Rails we will not create tables directly but will do it Rails way. The most simple approach is to generate model, view and controller with Rails scaffold generator:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rails</span> generate scaffold RubyWinSource name:string \
 author:string url:string
      invoke  active_record
      create    db<span class="n">/migrate/20110202205221_create_ruby_win_sources.rb</span>
      create    app<span class="n">/models/ruby_win_source.rb</span>
      invoke    test_unit
      create      test<span class="n">/unit/ruby_win_source_test.rb</span>
      create      test<span class="n">/fixtures/ruby_win_sources.yml</span>
       route  resources <span class="nl">:ruby_win_sources</span>
      invoke  scaffold_controller
      create    app<span class="n">/controllers/ruby_win_sources_controller.rb</span>
      invoke    erb
      create      app<span class="n">/views/ruby_win_sources</span>
      create      app<span class="n">/views/ruby_win_sources/index.html.erb</span>
      create      app<span class="n">/views/ruby_win_sources/edit.html.erb</span>
      create      app<span class="n">/views/ruby_win_sources/show.html.erb</span>
      create      app<span class="n">/views/ruby_win_sources/new.html.erb</span>
      create      app<span class="n">/views/ruby_win_sources/_form.html.erb</span>
      invoke    test_unit
      create      test<span class="n">/functional/ruby_win_sources_controller_test.rb</span>
      invoke    helper
      create      app<span class="n">/helpers/ruby_win_sources_helper.rb</span>
      invoke      test_unit
      create        test<span class="n">/unit/helpers/ruby_win_sources_helper_test.rb</span>
      invoke  stylesheets
      create    public<span class="n">/stylesheets/scaffold.css</span>
</code></pre>
</div><p>Scaffold generator will create model, migration file which will create database table that corresponds to it, controller and few basic views. We will not dive into Rails internals and will focus on the database related parts instead. Going on the Rails way let&#8217;s start database migration:</p>
<div class="highlight"><pre><code class="bat">C:\projects\rwin_book<span class="p">&gt;</span><span class="n">rake</span> db:migrate
(in c:<span class="n">/projects/rwin_book)</span>
<span class="o">==</span>  CreateRubyWinSources: migrating <span class="o">===========================================</span>
-- create_table(<span class="nl">:ruby_win_sources</span>)
   -<span class="p">&gt;</span> <span class="n">0</span>.<span class="m">0000</span>s
<span class="o">==</span>  CreateRubyWinSources: migrated (<span class="m">0</span>.<span class="m">0000</span>s) <span class="o">==================================</span>
</code></pre>
</div><p>If you want you can also list existing tables in Rails database console:</p>
<div class="highlight"><pre><code class="bat">sqlite&gt; .tables
ruby_win_sources   schema_migrations
</code></pre>
</div><p>Finally let&#8217;s add few good Web sources related to Ruby on Windows:</p>
<p><img src="/images/fig0302.png" title="List of Ruby on Windows sources." alt="List of Ruby on Windows sources." /></p>
<p>What we&#8217;ve accomplished so far? We created new Rails application, test SQlite3 connection through Rails database console, created new model and inserted few records in the database. Now when we know that Rails and SQlite3 are working on Windows, it is time to move on and explore other database adapters.</p>

      <br/>
      
      <a href="/book/ch03-00.html" title="Previous: Ruby On Rails 3 On Windows">&laquo; Ruby On Rails 3 On Windows</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-02.html" title="Next: Mysql Database">Mysql Database &raquo; </a>
       
    </div>

    <hr>
  </div>
</div>

</body>
</html>
