<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Sqlite3 Database</title>
   <meta name="author" content="Boško Ivanišević" />

   <link rel="stylesheet" href="/css/960.css" type="text/css" />
   <link rel="stylesheet" href="/css/reset.css" type="text/css" />
   <link rel="stylesheet" href="/css/text.css" type="text/css" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />

   <!-- Update your html tag to include the itemscope and itemtype attributes -->
   <html itemscope itemtype="http://schema.org/Book">

   <!-- Add the following three tags inside head -->
   <meta itemprop="name" content="Ruby On Windows Guides">
   <meta itemprop="description" content="Comprehensive guides for Ruby on Windows">

   <!-- Place this render call where appropriate -->
   <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
   </script>

   <script type="text/javascript">

     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-26061460-1']);
     _gaq.push(['_trackPageview']);

     (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>
</head>
<body>

<div class="container_12">
  <!--<div class="grid_2">
    <br/>
    <h1>Something</h1>
    <p>
      Lorem ipsum, etc, etc, so on and so forth
    </p>
  </div>-->

  <div id="main" class="grid_10">
    <div id="header" class="grid_10">
      <br/>
      <table>
        <tr>
          <td><img src="/images/rwg_logo_blue.png"/></td>
          <td>
            <h1>Ruby on Windows Guides</h1>
            <h4>Comprehensive guides for Ruby on Windows</h4>
            <h6>by Bosko Ivanisevic</h6>
          </td>
        </tr>
      </table>
    </div>

    <div id="menu" class="grid_10">
      <a href="/">Book</a>
      <a href="/about.html">About</a>
      <!-- <a href="/something.html">Something</a> -->
    </div>

    <div id="content" class="grid_10">
      <!-- Place this tag where you want the +1 button to render -->
      <g:plusone annotation="inline"></g:plusone>
      <br/>
      
      <a href="/book/ch03-00.html" title="Previous: Ruby On Rails 3 On Windows">&laquo; Ruby On Rails 3 On Windows</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-02.html" title="Next: Mysql Database">Mysql Database &raquo; </a>
       
      <br/><br/>

      <h2>SQlite3 database</h2>
<p>SQlite3 database is default database used when new Ruby on Rails application is created. This can be changed with the <code>-d</code> or <code>--database</code> option with allowed values: <code>mysql</code>, <code>oracle</code>, <code>postgresql</code>, <code>sqlite3</code>, <code>frontbase</code>, <code>ibm_db</code>. We&#8217;ll stick with default value and create new Rails application:</p>
<div>
<pre>
<code class='bat'>C:\projects&amp;gt;rails new rwin_book
create
create  <span class="caps">README</span>
create  Rakefile
create  config.ru
create  .gitignore
create  Gemfile
create  app
create  app/controllers/application_controller.rb
create  app/helpers/application_helper.rb
create  app/mailers
create  app/models
create  app/views/layouts/application.html.erb
create  config
create  config/routes.rb
create  config/application.rb
create  config/environment.rb
create  config/environments
create  config/environments/development.rb
create  config/environments/production.rb
create  config/environments/test.rb
create  config/initializers
create  config/initializers/backtrace_silencers.rb
create  config/initializers/inflections.rb
create  config/initializers/mime_types.rb
create  config/initializers/secret_token.rb
create  config/initializers/session_store.rb
create  config/locales
create  config/locales/en.yml
create  config/boot.rb
create  config/database.yml
create  db
create  db/seeds.rb
create  doc
create  doc/README_FOR_APP
create  lib
create  lib/tasks
create  lib/tasks/.gitkeep
create  log
create  log/server.log
create  log/production.log
create  log/development.log
create  log/test.log
create  public
create  public/404.html
create  public/422.html
create  public/500.html
create  public/favicon.ico
create  public/index.html
create  public/robots.txt
create  public/images
create  public/images/rails.png
create  public/stylesheets
create  public/stylesheets/.gitkeep
create  public/javascripts
create  public/javascripts/application.js
create  public/javascripts/controls.js
create  public/javascripts/dragdrop.js
create  public/javascripts/effects.js
create  public/javascripts/prototype.js
create  public/javascripts/rails.js
create  script
create  script/rails
create  test
create  test/fixtures
create  test/functional
create  test/integration
create  test/performance/browsing_test.rb
create  test/test_helper.rb
create  test/unit
create  tmp
create  tmp/sessions
create  tmp/sockets
create  tmp/cache
create  tmp/pids
create  vendor/plugins
create  vendor/plugins/.gitkeep</code>
</pre>
</div>
<p>Rails has created basic structure of our application. If you open config\database.yml file in the editor you will see that application is completely configured for SQlite3 database:</p>
<div>
<pre>
<code class='ruby'># SQLite version 3.x
<ol>
	<li>gem install sqlite3-ruby (not necessary on OS X Leopard)<br />
development:<br />
  adapter: sqlite3<br />
  database: db/development.sqlite3<br />
  pool: 5<br />
  timeout: 5000</li>
</ol>
<ol>
	<li>Warning: The database defined as &quot;test&quot; will be erased and</li>
	<li>re-generated from your development database when you run &quot;rake&quot;.</li>
	<li>Do not set this db to the same as development or production.<br />
test:<br />
  adapter: sqlite3<br />
  database: db/test.sqlite3<br />
  pool: 5<br />
  timeout: 5000</li>
</ol>
<p>production:<br />
  adapter: sqlite3<br />
  database: db/production.sqlite3<br />
  pool: 5<br />
  timeout: 5000</code><br />
  </pre></p>
</div>
<p>All three environments: development, test and production will use different SQlite3 databases named after the name of the corresponding environment with extension .sqlite3.</p>
<p>Let&#8217;s start our new application. Go to rwin_book directory and execute:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rails server</code>
</pre>
</div>
<p>If you get following message:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rails
<p>Could not find gem &#8216;sqlite3-ruby (&gt;= 0, runtime)&#8217; in any of the gem<br />
sources listed in your Gemfile.</code><br />
  </pre></p>
</div>
<p>Try running `bundle install`.</p>
<p>You probably have Rails 3.0.3 version which uses sqlite3-ruby gem which is obsolete. Between versions 1.3.2 and 1.3.3 sqlite3-ruby gem was renamed to sqlite3. However sqlite3-ruby still can be installed for compatibility purposes. This gem is actually empty one that just requires new sqlite3 gem and can be used till all applications are updated to use new one. So if this is the case just install sqlite3-ruby:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;gem install sqlite3-ruby --no-rdoc --no-ri
<p>#######################################################</p>
<p>Hello! The sqlite3-ruby gem has changed it&#8217;s name to just sqlite3.  Rather than<br />
installing `sqlite3-ruby`, you should install `sqlite3`.  Please update your<br />
dependencies accordingly.</p>
<p>Thanks from the Ruby sqlite3 team!</p>
<p>&lt;3 &lt;3 &lt;3 &lt;3</p>
<p>#######################################################<br />
Successfully installed sqlite3-ruby-1.3.3<br />
1 gem installed</code><br />
  </pre></p>
</div>
<p>You can now start application WEBrick server. If you followed all instructions from the book you will see server&#8217;s log messages in the Command Prompt:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rails server
<p>=&gt; Booting WEBrick<br />
=&gt; Rails 3.0.3 application starting in development on http://0.0.0.0:3000<br />
=&gt; Call with -d to detach<br />
=&gt; Ctrl-C to shutdown server<br />
[2011-02-02 19:01:07] <span class="caps">INFO</span>  WEBrick 1.3.1<br />
[2011-02-02 19:01:07] <span class="caps">INFO</span>  ruby 1.9.2 (2010-12-25) [i386-mingw32]<br />
[2011-02-02 19:01:07] <span class="caps">INFO</span>  WEBrick::HTTPServer#start: pid=800 port=3000</code><br />
  </pre></p>
</div>
<p>But if you jumped right to this chapter you there are few important things I must emphasize. If you built sqlite3 gem from the sources it is linked against libsqlite3-0.dll and this shared library must be in the path. In the chapter Building Native Gems we copied it to the C:\tools folder and added this directory to the path. You have to copy sqlite3.exe file to that folder too since we will need it soon.</p>
<p>On the other hand if you just installed binary version of sqlite3 gem it is linked against sqlite3.dll. This is actually the same shared library but with different name. In that case you have two solutions. The first one is to just rename built dll or you can download official version from SQlite3 site and unpack it to the folder that is in the path. Nevertheless SQlite3&#8217;s shared library and executable must be in the path. This is common mistake of Rails on Windows beginners so keep that on your mind.</p>
<p><img src="/images/fig0301.png" title="Rails welcome page" alt="Rails welcome page" /></p>
<p>Now open Web browser and go to Rails welcome page at http://localhost:3000. It gives you few hints how to start developing Rails application and, if you click on the top link, it will show you information about your application&#8217;s environment.</p>
<p>So far, so good. Be we still haven&#8217;t do anything with the database so we cannot be sure the SQlite3 gem is working as expected. Open new Command Prompt, go to the root folder of your new Rails application and execute following rake task:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rake db:create</code>
</pre>
</div>
<p>If you get warning messages that database files already exist do not worry since this is just and information that application has found newly created databases. Namely for SQlite3 there is no need to create database in advance. Rails will do that for you if database does not exist. Finally start Rails database console and check a list of all tables in the database:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rails dbconsole
<p>SQLite version 3.7.4<br />
Enter &quot;.help&quot; for instructions<br />
Enter <span class="caps">SQL</span> statements terminated with a &quot;;&quot;<br />
sqlite&gt; .tables<br />
sqlite&gt;</code><br />
  </pre></p>
</div>
<p>Of course we didn&#8217;t create any table so the list is empty. Time is to create some. Since we are working with Ruby on Rails we will not create tables directly but will do it Rails way. The most simple approach is to generate model, view and controller with Rails scaffold generator:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rails generate scaffold RubyWinSource name:string \
author:string url:string
invoke  active_record
create    db/migrate/20110202205221_create_ruby_win_sources.rb
create    app/models/ruby_win_source.rb
invoke    test_unit
create      test/unit/ruby_win_source_test.rb
create      test/fixtures/ruby_win_sources.yml
route  resources :ruby_win_sources
invoke  scaffold_controller
create    app/controllers/ruby_win_sources_controller.rb
invoke    erb
create      app/views/ruby_win_sources
create      app/views/ruby_win_sources/index.html.erb
create      app/views/ruby_win_sources/edit.html.erb
create      app/views/ruby_win_sources/show.html.erb
create      app/views/ruby_win_sources/new.html.erb
create      app/views/ruby_win_sources/_form.html.erb
invoke    test_unit
create      test/functional/ruby_win_sources_controller_test.rb
invoke    helper
create      app/helpers/ruby_win_sources_helper.rb
invoke      test_unit
create        test/unit/helpers/ruby_win_sources_helper_test.rb
invoke  stylesheets
create    public/stylesheets/scaffold.css</code>
</pre>
</div>
<p>Scaffold generator will create model, migration file which will create database table that corresponds to it, controller and few basic views. We will not dive into Rails internals and will focus on the database related parts instead. Going on the Rails way let&#8217;s start database migration:</p>
<div>
<pre>
<code class='bat'>C:\projects\rwin_book&amp;gt;rake db:migrate
<p>(in c:/projects/rwin_book)<br />
==  CreateRubyWinSources: migrating ===========<br />
&#8212; create_table(:ruby_win_sources)<br />
   -&gt; 0.0000s<br />
==  CreateRubyWinSources: migrated (0.0000s) ==========</code><br />
  </pre></p>
</div>
<p>If you want you can also list existing tables in Rails database console:</p>
<div>
<pre>
<code class='bat'>sqlite&amp;gt; .tables
<p>ruby_win_sources   schema_migrations</code><br />
  </pre></p>
</div>
<p>Finally let&#8217;s add few good Web sources related to Ruby on Windows:</p>
<p><img src="/images/fig0302.png" title="List of Ruby on Windows sources." alt="List of Ruby on Windows sources." /></p>
<p>What we&#8217;ve accomplished so far? We created new Rails application, test SQlite3 connection through Rails database console, created new model and inserted few records in the database. Now when we know that Rails and SQlite3 are working on Windows, it is time to move on and explore other database adapters.</p>

      <br/>
      
      <a href="/book/ch03-00.html" title="Previous: Ruby On Rails 3 On Windows">&laquo; Ruby On Rails 3 On Windows</a>
      

      
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
      <a href="/book/ch03-02.html" title="Next: Mysql Database">Mysql Database &raquo; </a>
       
    </div>

    <hr>
  </div>
</div>

</body>
</html>
